<header>
  <div class="logo">
    <img src="/img/logo.jpg" alt="Team Logo">
    <h1>Fleet Operations Tracker</h1>
  </div>

  <nav>
    <ng-container *ngIf="!User">
      <a [routerLink]="['/login']" class="auth-link"><i class="fas fa-sign-in-alt"></i> Login</a>
      <a href="/auth/google" class="hero-btn google-btn"><i class="fab fa-google"></i> Google</a>
      <a [routerLink]="['/signup']" class="auth-link"><i class="fas fa-user-plus"></i> Register</a>
    </ng-container>
    <ng-container *ngIf="User">
      <span class="user-name"><i class="fas fa-user-circle"></i> {{ User.fullName }}</span>
      <a [routerLink]="['/']" [class.active]="activePage === 'home'"><i class="fas fa-home"></i> Home</a>
      <a [routerLink]="['/create']" [class.active]="activePage === 'create'"><i class="fas fa-plus-circle"></i> Log New Trip</a>
      <a [routerLink]="['/trucks']" [class.active]="activePage === 'trucks'"><i class="fas fa-truck"></i> View Active Trips</a>
      <a href="/logout" class="auth-link logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </ng-container>
  </nav>
</header>

<main class="page-content">
  <div class="form-container" *ngIf="trip; else loadingOrError">

    <h2>{{ title }}</h2>

    <div class="message-box error-box" *ngIf="error">{{ error }}</div>
    <div class="message-box success-box" *ngIf="success">{{ success }}</div>

    <form (ngSubmit)="saveTrip()">

      <div class="form-row">
        <div class="form-group">
          <label>Trip Name (e.g., LAX-JFK-001) <span class="required-star">*</span></label>
          <input type="text" name="tripName" required
            [(ngModel)]="trip.tripName">
        </div>

        <div class="form-group">
          <label>Assigned Truck ID <span class="required-star">*</span></label>
          <input type="text" name="truckId" required
            [(ngModel)]="trip.truckId">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Driver Name <span class="required-star">*</span></label>
          <input type="text" name="driverName" required
            [(ngModel)]="trip.driverName">
        </div>

        <div class="form-group">
          <label>Status <span class="required-star">*</span></label>
          <select name="status" required [(ngModel)]="trip.status">
            <option value="Scheduled">Scheduled</option>
            <option value="In-Transit">In-Transit</option>
            <option value="Completed">Completed</option>
            <option value="Delayed">Delayed</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Route Start <span class="required-star">*</span></label>
          <input type="text" name="routeStart" required
            [(ngModel)]="trip.routeStart">
        </div>

        <div class="form-group">
          <label>Route End <span class="required-star">*</span></label>
          <input type="text" name="routeEnd" required
            [(ngModel)]="trip.routeEnd">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Scheduled Departure Date/Time</label>
          <input type="datetime-local" name="scheduledDeparture"
            [(ngModel)]="trip.scheduledDeparture">
        </div>

        <div class="form-group">
          <label>Estimated Arrival Date/Time</label>
          <input type="datetime-local" name="estimatedArrival"
            [(ngModel)]="trip.estimatedArrival">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Primary Cargo Type *</label>
          <select name="cargoType" required [(ngModel)]="trip.cargoType">
            <option value="General Freight">General Freight</option>
            <option value="Refrigerated Goods (Perishables)">Refrigerated Goods (Perishables)</option>
            <option value="Bulk Liquid">Bulk Liquid</option>
            <option value="Hazardous Materials">Hazardous Materials</option>
          </select>
        </div>

        <div class="form-group">
          <label>Total Weight (kg)</label>
          <input type="number" name="weightKg" placeholder="e.g., 25000" min="0"
            [(ngModel)]="trip.weightKg">
        </div>
      </div>

      <div class="form-group">
        <label>Manifest Summary *</label>
        <textarea name="manifestSummary" rows="4" required
          [(ngModel)]="trip.manifestSummary"></textarea>
      </div>

      <div class="form-group action-buttons">
        <a [routerLink]="['/trucks']" class="submit-btn secondary">Cancel</a>
        <button type="submit" class="submit-btn primary">Save Changes</button>
        <button type="button" (click)="isModalOpen = true" class="submit-btn delete-btn">Delete Trip</button>
      </div>

    </form>
  </div>
  
  <ng-template #loadingOrError>
    <div class="form-container">
        <h2 *ngIf="error">Error Loading Trip</h2>
        <p *ngIf="error">{{ error }}</p>
        <p *ngIf="!error">Loading trip details...</p>
    </div>
  </ng-template>
</main>

<div id="confirmationModal" class="modal" *ngIf="isModalOpen" [style.display]="isModalOpen ? 'block' : 'none'">
  <div class="modal-content">
    <h3>Delete this trip?</h3>
    <button (click)="deleteTrip()" class="submit-btn delete-btn">Confirm Delete</button>
    <button (click)="isModalOpen = false" class="submit-btn secondary">Cancel</button>
  </div>
</div>